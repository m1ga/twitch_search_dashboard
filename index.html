<!DOCTYPE html>

<html>

<head>

	<meta charset="utf-8" />

	<title>Twitch List</title>
	<style>
		* {
			font-size: 30px;
		}
	</style>
	<link rel="stylesheet" type="text/css" href="./main.css" />
	<link rel="stylesheet" type="text/css" href="./fonts/remixicon.css" />
	<script src="socket.io.min.js"></script>

</head>

<body>
	<nav>
		<div class="select_wrapper">
			<select id="topic" onchange="update()">
				<option value="science & technology">science & technology</option>
				<option value="just chatting">just chatting</option>
			</select>
		</div>
		<div class="select_wrapper">
			<select id="language" onchange="update()">
				<option value="all">all</option>
				<option value="de">german</option>
			</select>
		</div>
		<div class="select_wrapper">
			<select id="order" onchange="update()">
				<option value="recent">recent</option>
				<option value="high_low">high to low</option>

			</select>
		</div>
		<button onclick="update();" id="update">update</button>
	</nav>
	<div id="content"></div>
	<button onclick="loadMore()" id="more">load more</button>
	<script>
		var socket = io('http://127.0.0.1:3000');

		socket.on('data', function(obj) {
			var output = "";
			for (var i = 0; i < obj.data.length; ++i) {
				var item = obj.data[i];
				output += '<div class="user_' + item.username + ' item">';
				output += '<a target="_blank" href="' + item.link + '">';
				output += '<div class="img_container"><img loading="lazy" src="' + item.img + '" class="' + (item.isPartner ? "partner" : "") + '"/></div>';
				output += '<div class="title">' + item.title + '</div>';

				output += '<div class="infos">' + item.username + ' (' + item.viewersCount + ')</div></a>';
				output += '<div class="tags">';
				for (var t = 0; t < item.tags.length; ++t) {
					output += "<div>" + item.tags[t].localizedName + "</div>";
				}
				output += '</div>';
				output += '<div class="block" onclick="blockUser(event, \'' + item.username + '\')"> <i class="ri-delete-bin-line"></i> </div>'
				output += '</div>';
			}

			if (obj.isAppend) {
				document.getElementById("content").insertAdjacentHTML("beforeend", output);
			} else {
				document.getElementById("content").innerHTML = output;
			}
			if (obj.hasNextPage == false){
				document.getElementById("more").style.display= "none";
			} else {
				document.getElementById("more").style.display= "block";
			}
		})

		function update() {
			socket.emit("update", {
				topic: document.getElementById("topic").value,
				lang: document.getElementById("language").value,
				order: document.getElementById("order").value
			})
		}

		function loadMore() {
			socket.emit("loadMore", {
				topic: document.getElementById("topic").value,
				lang: document.getElementById("language").value,
				order: document.getElementById("order").value
			})
		}

		function blockUser(evt, user) {
			evt.preventDefault();
			var el = document.querySelector(".user_" + user);
			el.parentNode.removeChild(el);

			socket.emit("blockUser", {
				user: user
			})
			return false;
		}
		update();
	</script>

</body>

</html>
